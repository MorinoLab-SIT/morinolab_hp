<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>Morinolab CMS</title>
    <style>
      body {
        margin: 0;
        font-family: sans-serif;
        display: flex;
        height: 100vh;
      }
      #sidebar {
        width: 200px;
        background: #2f3b52;
        color: #fff;
        overflow-y: auto;
      }
      #sidebar button {
        width: 100%;
        padding: 10px;
        border: none;
        background: none;
        color: inherit;
        text-align: left;
        cursor: pointer;
      }
      #sidebar button:hover {
        background: #3e4b66;
      }
      #main {
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      #items {
        flex: 1;
        overflow-y: auto;
        padding: 16px;
      }
      #editor {
        flex: 1;
        display: none;
        flex-direction: column;
      }
      #editor textarea {
        flex: 1;
        resize: none;
        font-family: monospace;
        font-size: 14px;
        padding: 12px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th, td {
        padding: 8px 12px;
        border-bottom: 1px solid #ddd;
      }
    </style>
  </head>
  <body>
    <div id="sidebar"></div>
    <div id="main">
      <div id="items">
        <button id="addBtn">+ 追加</button>
        <table id="itemsTable">
          <thead>
            <tr><th>ID</th><th>タイトル</th><th>操作</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div id="editor">
        <button id="backBtn">← 一覧へ戻る</button>
        <h2 id="editorTitle"></h2>
        <textarea id="contentArea"></textarea>
      </div>
    </div>
    <script>
      const sidebar = document.getElementById('sidebar');
      const itemsDiv = document.getElementById('items');
      const editorDiv = document.getElementById('editor');
      const itemsTableBody = document.querySelector('#itemsTable tbody');
      const addBtn = document.getElementById('addBtn');
      const backBtn = document.getElementById('backBtn');
      const contentArea = document.getElementById('contentArea');
      const editorTitle = document.getElementById('editorTitle');

      let currentType = null;
      let currentId = null;
      let saveTimer = null;

      async function init() {
        const types = await window.api.getContentTypes();
        types.forEach((t) => {
          const btn = document.createElement('button');
          btn.textContent = t;
          btn.onclick = () => selectType(t);
          sidebar.appendChild(btn);
        });
        if (types.length) selectType(types[0]);
      }

      async function selectType(type) {
        currentType = type;
        editorDiv.style.display = 'none';
        itemsDiv.style.display = 'block';
        loadItems();
      }

      async function loadItems() {
        itemsTableBody.innerHTML = '';
        const items = await window.api.getItems(currentType);
        addBtn.onclick = async () => {
          await window.api.createItem(currentType);
          loadItems();
        };
        items.forEach((item) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${item.id}</td><td>${item.title}</td><td></td>`;
          const editBtn = document.createElement('button');
          editBtn.textContent = '編集';
          editBtn.onclick = () => openEditor(item.id, item.title);
          const delBtn = document.createElement('button');
          delBtn.textContent = '削除';
          delBtn.onclick = async () => {
            if (confirm('削除しますか?')) {
              await window.api.deleteItem(currentType, item.id);
              loadItems();
            }
          };
          const tdOps = tr.querySelector('td:last-child');
          tdOps.appendChild(editBtn);
          tdOps.appendChild(delBtn);
          itemsTableBody.appendChild(tr);
        });
      }

      async function openEditor(id, title) {
        currentId = id;
        editorDiv.style.display = 'flex';
        itemsDiv.style.display = 'none';
        editorTitle.textContent = `${currentType} / ${id} - ${title}`;
        const content = await window.api.loadContent(currentType, id);
        contentArea.value = content;
      }

      backBtn.onclick = () => {
        editorDiv.style.display = 'none';
        itemsDiv.style.display = 'block';
        loadItems();
      };

      // Real-time save with debounce
      contentArea.addEventListener('input', () => {
        if (!currentId) return;
        if (saveTimer) clearTimeout(saveTimer);
        saveTimer = setTimeout(() => {
          window.api.saveContent(currentType, currentId, contentArea.value);
        }, 500);
      });

      init();
    </script>
  </body>
</html> 